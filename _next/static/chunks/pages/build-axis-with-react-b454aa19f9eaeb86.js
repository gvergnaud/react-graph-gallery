(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4316],{91662:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/build-axis-with-react",function(){return n(97763)}])},72182:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var s=n(85893);let i=e=>{let{children:t}=e;return(0,s.jsx)("span",{className:"font-semibol bg-purple-100 p-1",children:t})}},97763:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var s=n(85893),i=n(67294),a=n(80153),r=n(43710),o=n(62594),l=n(81122),c=n(61651),d=n(59973),h=n(34699),x=n(3572),u=n(72182),m=n(81341),p=n(19618);let f=(0,s.jsxs)("p",{children:["This post explains how to build axes from d3 scales for a chart. It relies on the ",(0,s.jsx)("code",{children:"tick()"})," method to compute the tick positions and use react for the rendering. The code of the ",(0,s.jsx)("code",{children:"BottomAxis"})," and"," ",(0,s.jsx)("code",{children:"LeftAxis"}),"components is provided, together with some reproducible examples."]}),g='\nconst TICK_LENGTH = 6;\n\nexport const AxisBottom = ({ xScale, pixelsPerTick }) => {\n  const range = xScale.range();\n\n  const ticks = useMemo(() => {\n    const width = range[1] - range[0];\n    const numberOfTicksTarget = Math.floor(width / pixelsPerTick);\n\n    return xScale.ticks(numberOfTicksTarget).map((value) => ({\n      value,\n      xOffset: xScale(value),\n    }));\n  }, [xScale]);\n\n  return (\n    <>\n      {/* Main horizontal line */}\n      <path\n        d={["M", range[0], 0, "L", range[1], 0].join(" ")}\n        fill="none"\n        stroke="currentColor"\n      />\n\n      {/* Ticks and labels */}\n      {ticks.map(({ value, xOffset }) => (\n        <g key={value} transform={`translate(${xOffset}, 0)`}>\n          <line y2={TICK_LENGTH} stroke="currentColor" />\n          <text\n            key={value}\n            style={{\n              fontSize: "10px",\n              textAnchor: "middle",\n              transform: "translateY(20px)",\n            }}\n          >\n            {value}\n          </text>\n        </g>\n      ))}\n    </>\n  );\n};\n'.trim(),j='\nconst TICK_LENGTH = 6;\n\nexport const AxisLeft = ({ yScale, pixelsPerTick }) => {\n  const range = yScale.range();\n\n  const ticks = useMemo(() => {\n    const height = range[0] - range[1];\n    const numberOfTicksTarget = Math.floor(height / pixelsPerTick);\n\n    return yScale.ticks(numberOfTicksTarget).map((value) => ({\n      value,\n      yOffset: yScale(value),\n    }));\n  }, [yScale]);\n\n  return (\n    <>\n      {/* Main vertical line */}\n      <path\n        d={["M", 0, range[0], "L", 0, range[1]].join(" ")}\n        fill="none"\n        stroke="currentColor"\n      />\n\n      {/* Ticks and labels */}\n      {ticks.map(({ value, yOffset }) => (\n        <g key={value} transform={`translate(0, ${yOffset})`}>\n          <line x2={-TICK_LENGTH} stroke="currentColor" />\n          <text\n            key={value}\n            style={{\n              fontSize: "10px",\n              textAnchor: "middle",\n              transform: "translateX(-20px)",\n            }}\n          >\n            {value}\n          </text>\n        </g>\n      ))}\n    </>\n  );\n};\n'.trim();function b(){let e=(0,i.useRef)(null),t=(0,d.B)(e);return(0,s.jsxs)(a.A,{title:"Building graph axes with React (and d3.js)",seoDescription:"This blogpost explains how to build axes from d3 scales for a chart. It relies on the tick() method to compute the tick positions and use react for the rendering.",children:[(0,s.jsx)(r.Z,{title:"Building graph axes with React (and d3.js)",description:f}),(0,s.jsxs)("div",{className:"w-full flex flex-col justify-center items-center",children:[(0,s.jsx)("div",{style:{height:250,width:"100%",maxWidth:500},ref:e,children:(0,s.jsx)(h.X,{width:t.width,height:t.height})}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 max-w-md italic text-center mt-4 font-light",children:["This minimal example uses ",(0,s.jsx)("code",{children:"scaleLinear()"})," to compute the scales, ",(0,s.jsx)("code",{children:"ticks()"})," to compute tick positions and react to render the axes."]})]}),(0,s.jsx)("h2",{id:"bottom",children:"Bottom Axis"}),(0,s.jsxs)("p",{children:["The code snippet below builds a ",(0,s.jsx)("code",{children:"AxisBottom"})," component. It is"," ",(0,s.jsxs)(u.b,{children:["very much inspired from"," ",(0,s.jsx)("a",{href:"https://wattenberger.com/blog/react-and-d3",children:"this blogpost"})," ","by Amelia Wattenberger"]}),". I've just changed a few things, notably passing a scale as input instead of a range and a domain."]}),(0,s.jsxs)("p",{children:["The logic mainly relies on the ",(0,s.jsx)("code",{children:"ticks()"})," method of a d3 scale. It takes a target number of ticks as input, find the most appropriate way to build smart ticks based on this target, and returns an array with all the tick positions."]}),(0,s.jsx)("p",{children:"What follows is just some svg drawings based on those tick positions."}),(0,s.jsx)(x.d,{code:g}),(0,s.jsx)("h2",{id:"left",children:"Left"}),(0,s.jsx)("p",{children:"Exactly the same idea than for the bottom axis above"}),(0,s.jsx)(x.d,{code:j}),(0,s.jsx)("h2",{id:"margins",children:"Margins"})," ",(0,s.jsx)("p",{children:"The bottom and left axes are not displays at the border of the main chart component. Some margins are computed by the viz component. It is important to understand that a chart is composed by:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside pl-10",children:[(0,s.jsxs)("li",{children:["the global chart area, often specified by the ",(0,s.jsx)("code",{children:"width"})," and"," ",(0,s.jsx)("code",{children:"height"})," properties of the chart components."]}),(0,s.jsx)("li",{children:'the "bounds" area, i.e. the area located inside the x and y axis. It is calculated by substracting the margins'})]}),(0,s.jsx)("h2",{id:"usage",children:"Usage"})," ",(0,s.jsx)("p",{children:"Once you have the bottom and left axis component described above you just need to call them properly. You need to compute the bounds area by substracting the margins to the total svg area."}),(0,s.jsx)("p",{children:"Don't forget to add an additional translation to the bottom axis to render it... at the bottom."}),(0,s.jsx)(l.$,{vizName:"AxisBasic",VizComponent:m.c,maxWidth:600,height:300,caption:"This axis is rendered without using d3.js to render."}),(0,s.jsx)("h2",{id:"the d3 way",children:"Alternative: the d3 way"})," ",(0,s.jsxs)("p",{children:["If you're a d3.js afficionados and want to deal with as little react as possible, you can still use the good old ",(0,s.jsx)("code",{children:"axisBottom()"})," and"," ",(0,s.jsx)("code",{children:"axisLeft()"})," methods of d3 and wrap them in a",(0,s.jsx)("code",{children:"useEffect()"})," hook."]}),(0,s.jsx)("p",{children:"Here is an example below:"}),(0,s.jsx)(l.$,{vizName:"AxisBasicD3",VizComponent:p.d,maxWidth:600,height:300,caption:"This axis is rendered using d3. The d3 necessary functions are called from a useEffect"}),(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)("hr",{className:"full-bleed  bord er bg-gray-200 mb-3 mt-10"}),(0,s.jsx)(c.Z,{chartFamily:"general"}),(0,s.jsx)("div",{className:"mt-20"}),(0,s.jsx)(o.Z,{})]})}},19618:function(e,t,n){"use strict";n.d(t,{d:function(){return c}});var s=n(85893),i=n(67294),a=n(88657);let r=e=>{let{width:t,height:n}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("defs",{children:(0,s.jsx)("pattern",{id:"pattern_rkDsm",patternUnits:"userSpaceOnUse",width:"9.5",height:"2.5",patternTransform:"rotate(41)",children:(0,s.jsx)("line",{x1:"0",y:"0",x2:"0",y2:"9.5",stroke:"#D9B9F3",strokeWidth:"1"})})}),(0,s.jsx)("rect",{width:t,height:n,fill:"url(#pattern_rkDsm)",opacity:"1"})]})},o={top:30,right:30,bottom:50,left:50},l=e=>{let{width:t,height:n}=e,l=(0,i.useRef)(null),c=t-o.right-o.left,d=n-o.top-o.bottom,h=(0,i.useMemo)(()=>a.BYU().domain([0,10]).range([0,c]),[t]),x=(0,i.useMemo)(()=>a.BYU().domain([0,10]).range([d,0]),[n]);return(0,i.useEffect)(()=>{let e=a.Ys(l.current);e.selectAll("*").remove();let t=a.LLu(h);e.append("g").attr("transform","translate(0,"+d+")").call(t);let n=a.y4O(x);e.append("g").call(n)},[h,x,d]),(0,s.jsx)("div",{children:(0,s.jsxs)("svg",{width:t,height:n,style:{display:"inline-block"},children:[(0,s.jsx)("g",{width:c,height:d,transform:"translate(".concat([o.left,o.top].join(","),")"),children:(0,s.jsx)(r,{width:c,height:d})}),(0,s.jsx)("g",{width:c,height:d,ref:l,transform:"translate(".concat([o.left,o.top].join(","),")")})]})})},c=e=>{let{width:t=700,height:n=400}=e;return(0,s.jsx)(l,{width:t,height:n})}}},function(e){e.O(0,[2343,7754,8657,7823,8190,3710,2594,2069,9774,2888,179],function(){return e(e.s=91662)}),_N_E=e.O()}]);